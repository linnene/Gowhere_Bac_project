# GoWhere åç«¯é¡¹ç›® API æ¥å£æ–‡æ¡£

## åŸºç¡€ä¿¡æ¯

- **é¡¹ç›®åç§°**: GoWhere Backend
- **API ç‰ˆæœ¬**: v1.0
- **åŸºç¡€ URL**: `http://localhost:8000/v1` (å¼€å‘ç¯å¢ƒ)
- **æŠ€æœ¯æ ˆ**: FastAPI + SQLAlchemy + Redis

## ç›®å½•

1. [ç”¨æˆ·æ³¨å†Œæ¨¡å— (Signup)](#ç”¨æˆ·æ³¨å†Œæ¨¡å—-signup)
2. [ç”¨æˆ·ç™»å½•æ¨¡å— (Login)](#ç”¨æˆ·ç™»å½•æ¨¡å—-login)
3. [é‚®ç®±éªŒè¯æ¨¡å— (Email)](#é‚®ç®±éªŒè¯æ¨¡å—-email)
4. [AIèŠå¤©æ¨¡å— (AI)](#aièŠå¤©æ¨¡å—-ai)

---

## ç”¨æˆ·æ³¨å†Œæ¨¡å— (Signup)

### 1. åˆ›å»ºç”¨æˆ·

**æ¥å£æè¿°**: åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·

- **è¯·æ±‚æ–¹å¼**: `POST`
- **æ¥å£è·¯å¾„**: `/v1/Signup/creat_user`
- **æ¥å£è¯´æ˜**: é€šè¿‡ç”¨æˆ·ä¿¡æ¯åˆ›å»ºæ–°ç”¨æˆ·ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æ³¨å†Œå’Œå¯†ç æœ‰æ•ˆæ€§

#### è¯·æ±‚å‚æ•° (Body)

```json
{
  "UserEmail": "string",
  "UserPassword": "string",
  "UserName": "string",
  "UserPhone": "string"
}
```

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| UserEmail | string | æ˜¯ | ç”¨æˆ·é‚®ç®±åœ°å€ |
| UserPassword | string | æ˜¯ | ç”¨æˆ·å¯†ç ï¼ˆä¸èƒ½ä¸ºç©ºæˆ–"string"ï¼‰ |
| UserName | string | æ˜¯ | ç”¨æˆ·å§“å |
| UserPhone | string | å¦ | ç”¨æˆ·ç”µè¯å·ç  |

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200)**
```json
{
  "UserId": "string",
  "UserEmail": "string",
  "UserName": "string",
  "UserPhone": "string",
  "EmailVerified": false,
  "CreatedAt": "2024-01-01T12:00:00Z"
}
```

**é”™è¯¯å“åº”**
```json
{
  "message": "password can't be None"
}
```

### 2. è·å–ç”¨æˆ·ä¿¡æ¯

**æ¥å£æè¿°**: æ ¹æ®ç”¨æˆ·IDæˆ–Tokenè·å–ç”¨æˆ·ä¿¡æ¯

- **è¯·æ±‚æ–¹å¼**: `GET`
- **æ¥å£è·¯å¾„**: `/v1/Signup/get_user`

#### è¯·æ±‚å‚æ•° (Query)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| user_id | string | å¦ | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ |
| Tokens | string | å¦ | ç”¨æˆ·è®¿é—®ä»¤ç‰Œ |

**æ³¨æ„**: user_id å’Œ Tokens è‡³å°‘æä¾›ä¸€ä¸ª

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200)**
```json
{
  "UserId": "string",
  "UserEmail": "string",
  "UserName": "string",
  "UserPhone": "string",
  "EmailVerified": true,
  "CreatedAt": "2024-01-01T12:00:00Z"
}
```

---

## ç”¨æˆ·ç™»å½•æ¨¡å— (Login)

### 1. ç”¨æˆ·ç™»å½•

**æ¥å£æè¿°**: ç”¨æˆ·ç™»å½•éªŒè¯ï¼Œè¿”å›è®¿é—®ä»¤ç‰Œ

- **è¯·æ±‚æ–¹å¼**: `POST`
- **æ¥å£è·¯å¾„**: `/v1/Login/Login_user`

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | ä½ç½® | è¯´æ˜ |
|--------|------|------|------|------|
| userpassword | string | æ˜¯ | Form Data | ç”¨æˆ·å¯†ç  |
| userid | string | æ˜¯ | Query | ç”¨æˆ·ID |

#### è¯·æ±‚ç¤ºä¾‹

```http
POST /v1/Login/Login_user?userid=12345
Content-Type: application/x-www-form-urlencoded

userpassword=your_password
```

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200)**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**é”™è¯¯å“åº”**
```json
{
  "detail": "éœ€è¦ID"
}
```

### 2. æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**æ¥å£æè¿°**: æ›´æ–°ç”¨æˆ·ä¿¡æ¯

- **è¯·æ±‚æ–¹å¼**: `PUT`
- **æ¥å£è·¯å¾„**: `/v1/Login/update_user`

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | ä½ç½® | è¯´æ˜ |
|--------|------|------|------|------|
| user_id | string | æ˜¯ | Query | ç”¨æˆ·ID |
| new_user | object | æ˜¯ | Body | æ›´æ–°çš„ç”¨æˆ·ä¿¡æ¯ |

#### è¯·æ±‚ç¤ºä¾‹

```json
{
  "UserName": "æ–°ç”¨æˆ·å",
  "UserPhone": "æ–°ç”µè¯å·ç ",
  "UserEmail": "new@email.com"
}
```

---

## é‚®ç®±éªŒè¯æ¨¡å— (Email)

### 1. å‘é€éªŒè¯é‚®ä»¶

**æ¥å£æè¿°**: å‘æŒ‡å®šé‚®ç®±å‘é€éªŒè¯ç é‚®ä»¶

- **è¯·æ±‚æ–¹å¼**: `POST`
- **æ¥å£è·¯å¾„**: `/v1/email/send_template_email`

#### è¯·æ±‚å‚æ•° (Body)

```json
{
  "email": "user@example.com",
  "subject": "é‚®ç®±éªŒè¯",
  "template": "verification"
}
```

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200)**
```json
{
  "message": "email has been sent"
}
```

### 2. éªŒè¯é‚®ç®±éªŒè¯ç 

**æ¥å£æè¿°**: éªŒè¯ç”¨æˆ·è¾“å…¥çš„é‚®ç®±éªŒè¯ç 

- **è¯·æ±‚æ–¹å¼**: `POST`
- **æ¥å£è·¯å¾„**: `/v1/email/verify_code`

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| code | string | æ˜¯ | 6ä½éªŒè¯ç  |
| email | string | æ˜¯ | é‚®ç®±åœ°å€ |

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200)**
```json
{
  "message": "Verification successful"
}
```

**å¤±è´¥å“åº” (400)**
```json
{
  "message": "Invalid verification code"
}
```

---

## AIèŠå¤©æ¨¡å— (AI)

### 1. èŠå¤©æ¥å£

**æ¥å£æè¿°**: ä¸AIè¿›è¡Œå¯¹è¯èŠå¤©

- **è¯·æ±‚æ–¹å¼**: `GET`
- **æ¥å£è·¯å¾„**: `/v1/AI/chat`

#### è¯·æ±‚å‚æ•° (Query)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| user_id | string | æ˜¯ | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ |
| message | string | æ˜¯ | å‘é€ç»™AIçš„æ¶ˆæ¯å†…å®¹ |

#### è¯·æ±‚ç¤ºä¾‹

```http
GET /v1/AI/chat?user_id=12345&message=ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
```

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200)**
```json
{
  "response": "AIå›å¤çš„æ¶ˆæ¯å†…å®¹",
  "timestamp": "2024-01-01T12:00:00Z",
  "user_id": "12345"
}
```

**é”™è¯¯å“åº” (500)**
```json
{
  "detail": "é”™è¯¯è¯¦ç»†ä¿¡æ¯"
}
```

### 2. èŠå¤©å†å²æ¥å£

**æ¥å£æè¿°**: è·å–ç”¨æˆ·çš„èŠå¤©å†å²è®°å½•

- **è¯·æ±‚æ–¹å¼**: `GET`
- **æ¥å£è·¯å¾„**: `/v1/AI/chat_history`

#### è¯·æ±‚å‚æ•° (Query)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| user_id | string | æ˜¯ | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ |

#### è¯·æ±‚ç¤ºä¾‹

```http
GET /v1/AI/chat_history?user_id=12345
```

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº” (200)**
```json
{
  "user_id": "12345",
  "chat_history": [
    {
      "id": 1,
      "message": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹",
      "response": "AIå›å¤å†…å®¹",
      "timestamp": "2024-01-01T12:00:00Z"
    },
    {
      "id": 2,
      "message": "å¦ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯",
      "response": "å¦ä¸€æ¡AIå›å¤",
      "timestamp": "2024-01-01T12:05:00Z"
    }
  ]
}
```

---

## é€šç”¨é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒè®¿é—® |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

## æ•°æ®æ¨¡å‹

### UserCreate
```json
{
  "UserEmail": "string",
  "UserPassword": "string", 
  "UserName": "string",
  "UserPhone": "string"
}
```

### UserRead
```json
{
  "UserId": "string",
  "UserEmail": "string",
  "UserName": "string", 
  "UserPhone": "string",
  "EmailVerified": "boolean",
  "CreatedAt": "datetime"
}
```

### UserUpdate
```json
{
  "UserName": "string",
  "UserPhone": "string",
  "UserEmail": "string"
}
```

### EmailSchema
```json
{
  "email": "string",
  "subject": "string",
  "template": "string"
}
```

## å¼€å‘ç¯å¢ƒé…ç½®

### å¯åŠ¨æœåŠ¡
```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### ç¯å¢ƒä¾èµ–
- Python 3.8+
- FastAPI
- SQLAlchemy (å¼‚æ­¥)
- Redis
- SMTP é‚®ä»¶æœåŠ¡

## æ³¨æ„äº‹é¡¹

1. **è®¤è¯å®‰å…¨**: ç™»å½•æ¥å£è¿”å›JWT tokenï¼Œéœ€è¦å¦¥å–„ä¿å­˜
2. **é‚®ç®±éªŒè¯**: æ³¨å†Œåéœ€è¦è¿›è¡Œé‚®ç®±éªŒè¯æ‰èƒ½å®Œå…¨æ¿€æ´»è´¦æˆ·
3. **å¯†ç å®‰å…¨**: å¯†ç åœ¨æ•°æ®åº“ä¸­å·²åŠ å¯†å­˜å‚¨
4. **å¼‚æ­¥å¤„ç†**: æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„
5. **Redisç¼“å­˜**: éªŒè¯ç å­˜å‚¨åœ¨Redisä¸­ï¼Œæœ‰è¿‡æœŸæ—¶é—´
6. **é”™è¯¯å¤„ç†**: æ‰€æœ‰æ¥å£éƒ½åŒ…å«å®Œæ•´çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

## æµ‹è¯•çŠ¶æ€

- âœ… ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ (æµ‹è¯•å®Œæˆ - 2025/3/8)
- âœ… ç”¨æˆ·ç™»å½•åŠŸèƒ½ (æµ‹è¯•å®Œæˆ - 2025/3/8) 
- âœ… é‚®ç®±éªŒè¯åŠŸèƒ½ (æµ‹è¯•å®Œæˆ - 2025/3/8)
- âš ï¸ é‚®ä»¶å‘é€åŠŸèƒ½ (å­˜åœ¨SMTPé…ç½®é—®é¢˜)
- ğŸ”„ AIèŠå¤©åŠŸèƒ½ (å¼€å‘ä¸­)
- ğŸ”„ ç”¨æˆ·ä¿¡æ¯æ›´æ–° (å­˜åœ¨æŸ¥æ‰¾ç”¨æˆ·bug)

## å·²çŸ¥é—®é¢˜

1. **é‚®ä»¶å‘é€**: SMTPé…ç½®é—®é¢˜ï¼Œå»ºè®®æ›´æ¢ä¸ºHotmail SMTP
2. **ç”¨æˆ·æ›´æ–°**: æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ—¶å¯èƒ½æ— æ³•æ‰¾åˆ°ç”¨æˆ·
3. **å®‰å…¨éªŒè¯**: get_useræ¥å£éœ€è¦å¢åŠ æƒé™éªŒè¯
